#!/bin/bash

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç, –µ—Å–ª–∏ –∫–∞–∫–∞—è-—Ç–æ –∫–æ–º–∞–Ω–¥–∞ —É–ø–∞–¥–µ—Ç —Å –æ—à–∏–±–∫–æ–π
set -e

echo "üé® –ù–∞—á–∏–Ω–∞—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å—Ö–µ–º—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã..."

# 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–∞–ø–∫–∞ –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫, –µ—Å–ª–∏ –Ω–µ—Ç - —Å–æ–∑–¥–∞–µ–º
mkdir -p keymap-drawer

# 2. –ü–∞—Ä—Å–∏–º ZMK —Ñ–∞–π–ª –≤ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π YAML
# –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ª–æ–µ–≤ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
echo "‚öôÔ∏è  –ü–∞—Ä—Å–∏–Ω–≥ config/sofle.keymap..."
keymap -c keymap_drawer.config.yaml parse -z config/sofle.keymap > sofle_parsed.yaml

# 3. –†–∏—Å—É–µ–º SVG
# –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º –≥–µ–æ–º–µ—Ç—Ä–∏—é Sofle, —Ç–∞–∫ –∫–∞–∫ –º—ã —É–±—Ä–∞–ª–∏ –µ—ë –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
echo "üñåÔ∏è  –†–∏—Å–æ–≤–∞–Ω–∏–µ SVG..."
keymap -c keymap_drawer.config.yaml draw --qmk-keyboard sofle/rev1 --qmk-layout LAYOUT sofle_parsed.yaml > keymap-drawer/sofle.svg

# 4. –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
rm sofle_parsed.yaml

echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –°—Ö–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞: keymap-drawer/sofle.svg"